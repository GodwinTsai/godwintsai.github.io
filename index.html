<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>GodwinTsai</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="蔡国荣">
<meta property="og:type" content="website">
<meta property="og:title" content="GodwinTsai">
<meta property="og:url" content="http://godwintsai.github.io/">
<meta property="og:site_name" content="GodwinTsai">
<meta property="og:description" content="蔡国荣">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="GodwinTsai">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="GodwinTsai" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">GodwinTsai</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://godwintsai.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2022/07/16/hello-world/" class="article-date">
  <time class="dt-published" datetime="2022-07-16T11:32:02.737Z" itemprop="datePublished">2022-07-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2022/07/16/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2022/07/16/hello-world/" data-id="cl5nt9716000umpuv5n7u50n2" data-title="Hello World" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Skill&amp;Buff Editor" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/02/Skill&Buff%20Editor/" class="article-date">
  <time class="dt-published" datetime="2020-04-02T02:57:25.000Z" itemprop="datePublished">2020-04-02</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/02/Skill&Buff%20Editor/">Skill&amp;Buff Editor</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<p><img src="https://img-blog.csdnimg.cn/20200402103552805.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<ul>
<li>之前项目做的一个moba的skill&amp;buff编辑器，采用winform实现，独立于Unity。</li>
<li>主编辑窗口（图中左上角），通过c# Attribute，反射技能逻辑的字段，采用节点和连线编辑，独立于具体的技能逻辑。</li>
<li>节点的属性编辑（图中右上角）通过扩展winform的profertygrid，实现了包括下拉选择、下拉多选、自定义类列表、自定义类字典等多种格式编辑（如图中右下角为点击“使用条件”的二级配置窗口）</li>
<li>可通过内嵌Unity窗口（图中左下角），可也自己打开项目Unity技能测试场景，通过socket连接，编辑好技能后实时重新加载配置，测试技能。</li>
<li>后续再详细总结每个部分的实现</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2020/04/02/Skill&Buff%20Editor/" data-id="cl5nt970w0006mpuvaatib5w7" data-title="Skill&amp;Buff Editor" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Unity世界坐标局部坐标转换" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/04/01/Unity%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E5%B1%80%E9%83%A8%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/" class="article-date">
  <time class="dt-published" datetime="2020-04-01T12:23:08.000Z" itemprop="datePublished">2020-04-01</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/04/01/Unity%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E5%B1%80%E9%83%A8%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/">Unity世界坐标局部坐标转换</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h2 id="world-pos-gt-ui-local-pos"><a href="#world-pos-gt-ui-local-pos" class="headerlink" title="world pos -&gt; ui local pos"></a>world pos -&gt; ui local pos</h2><p>世界坐标转UI局部坐标比较常用，也比较简单。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Vector3 worldPosition = _3dTransform.position;</span><br><span class="line">Vector3 screenPosition = _3dCamera.WorldToScreenPoint(worldPosition);</span><br><span class="line"></span><br><span class="line">Vector2 localPostion;</span><br><span class="line"><span class="keyword">if</span> (RectTransformUtility.ScreenPointToLocalPointInRectangle((RectTransform)_canvas.transform, screenPosition, _canvas.worldCamera, <span class="keyword">out</span> localPostion))</span><br><span class="line">&#123;</span><br><span class="line">    _2dTransform.localPosition = localPostion;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ui-local-pos-gt-world-pos"><a href="#ui-local-pos-gt-world-pos" class="headerlink" title="ui local pos -&gt; world pos"></a>ui local pos -&gt; world pos</h2><ol>
<li><p>如果知道UI物件，直接通过transform.position获得。</p>
</li>
<li><p>如果只知道UI父节点以及一个相对于父节点的局部坐标，可以通过：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">worldPos = parentTransform.TransformPoint(localPos);</span><br></pre></td></tr></table></figure>
</li>
<li><p>如果只知道一个UI坐标，需要先转到屏幕坐标系，再转到世界坐标系：</p>
</li>
</ol>
<pre><code>首先主要考虑的是UI适配，通常canvas scale会设置成Scale With Screen Size，Canvas大小就不一定是屏幕分辨率的大小。

假设原本的标准分辨率是720x1280，在ipad的分辨率1536x2048上显示时：

假如是以高度为适配，那么Canvas 实际高度为1280，宽度为1536 / 2048 \* 1280 = 960，拉伸比例为2048 / 1280 = 1.6;

假如是以宽度为适配，那么Canvas实际宽度为720，高度为2048 / 1536 \* 720 = 960，拉伸比例为1536 / 720 = 2.13;

那么屏幕坐标 = Canvas下的UI局部坐标 \* 拉伸比例 + 屏幕宽高 / 2;

因为Canvas UI局部坐标系的原点在中间，而屏幕坐标系的原点在左下角。

接着再通过ScreenToWorldPoint\(screenPos\)转为世界坐标。

代码如下：
</code></pre>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> standardSize = <span class="keyword">new</span> Vector2(<span class="number">720f</span>, <span class="number">1280f</span>);</span><br><span class="line"><span class="keyword">var</span> scale = canvasScaler.matchWidthOrHeight == <span class="number">0</span></span><br><span class="line">    ? Screen.width / standardSize.x</span><br><span class="line">    : Screen.height / standardSize.y;</span><br><span class="line"><span class="keyword">var</span> screenPos = localPos * scale + <span class="number">0.5f</span> * <span class="keyword">new</span> Vector2(Screen.width, Screen.height);</span><br><span class="line"><span class="keyword">var</span> worldPos = <span class="keyword">new</span> Vector3();</span><br><span class="line"> RectTransformUtility.ScreenPointToWorldPointInRectangle((RectTransform) canvas.transform, screenPos, uiCamera, <span class="keyword">out</span> worldPos);</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>如果只是为了获得偏移，可以简单地通过比例来获得：<br>worldOffsetY &#x2F; uicamera.orthographicSize * 2 &#x3D; uiOffsetY &#x2F; Screen.height</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2020/04/01/Unity%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E5%B1%80%E9%83%A8%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/" data-id="cl5nt9711000impuvbk112vur" data-title="Unity世界坐标局部坐标转换" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Unity动画优化!Optimize Game Objects" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/03/12/Unity%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96!Optimize%20Game%20Objects/" class="article-date">
  <time class="dt-published" datetime="2020-03-12T06:43:16.000Z" itemprop="datePublished">2020-03-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity-Optimize/">Unity Optimize</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/03/12/Unity%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96!Optimize%20Game%20Objects/">Unity动画优化:Optimize Game Objects</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h3 id="一、Optimize-Game-Objects介绍"><a href="#一、Optimize-Game-Objects介绍" class="headerlink" title="一、Optimize Game Objects介绍"></a>一、Optimize Game Objects介绍</h3><p>Unity中FBX的导入设置,Inspector中Rig页签下有Optimize Game Objects选项，<br><img src="https://img-blog.csdnimg.cn/20200312143046411.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"><br>Unity官方文档的解释是：<br>In the GameObjects hierarchy of a character, the GameObjects which only contain Transform component, will be optimized out unless they are specified in extraExposedTransformPaths for better CPU performance. The remaining GameObjects hierarchy will be flattened.</p>
<p>当勾选了该选项后，FBX中的骨骼节点，如果只有Transform组件，会被剔除不导入，<br>如果需要某些骨骼节点不被剔除，例如需要挂点，则需要在Extra Transform Paths中勾选对应的骨骼名称。<br>注意：不剔除的节点会被移到根节点之下，因此代码中不能通过原有路径查找（transform.Find(“Bip001&#x2F;Bip001 Spine”)）。</p>
<p>原理：<br>Remove and store the GameObject Transform hierarchy of the imported character in the Avatar and Animator component. If enabled, the SkinnedMeshRenderers of the character use the Unity animation system’s internal skeleton, which improves the performance of the animated characters.<br>Only available if the Avatar Definition is set to Create From This Model.</p>
<p>Unity会将骨骼信息映射到avatar中，这样，unity在更新骨骼矩阵时，不再考虑场景中的Transform节点，也不用更新它的坐标，而是直接通过获取avatar骨骼信息来更新蒙皮，表现动画，从而节省了cpu计算。</p>
<h3 id="二、优化前后对比"><a href="#二、优化前后对比" class="headerlink" title="二、优化前后对比"></a>二、优化前后对比</h3><p>优化前模型结构：<br><img src="https://img-blog.csdnimg.cn/20200312143213881.png" alt="在这里插入图片描述"><br>优化后模型结构：<br><img src="https://img-blog.csdnimg.cn/20200312143233549.png" alt="在这里插入图片描述"><br>Animator.hasTransformHierarchy会变为false<br>SkinMeshRender.rootBone会变为空</p>
<h3 id="三、代码"><a href="#三、代码" class="headerlink" title="三、代码"></a>三、代码</h3><p>对应接口：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AnimatorUtility.DeoptimizeTransformHierarchy(GameObject go);</span><br><span class="line">AnimatorUtility.OptimizeTransformHierarchy(GameObject go, <span class="built_in">string</span>[] exposedTransforms)</span><br></pre></td></tr></table></figure>

<p>不过我们项目是把fbx内嵌在模型prefab中，使用该接口会报错：<br><img src="https://img-blog.csdnimg.cn/20200312143539587.png" alt="在这里插入图片描述"><br>因此改用修改ModelImporter的方式。<br>另外我们会有些虚拟挂载点绑定在骨骼下。<br>因此需要在编辑挂载点前显示所有骨骼，编辑好后优化剔除无用的骨骼。</p>
<p>取消优化：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">UndoOptimize</span>(<span class="params">GameObject root</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> animator = root.GetComponentInChildren&lt;Animator&gt;();<span class="comment">//Animator组件挂在fbx节点上</span></span><br><span class="line">            <span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> fbxGo = animator.gameObject;</span><br><span class="line">            <span class="keyword">var</span> fbxPath = AssetDatabase.GetAssetPath(PrefabUtility.GetCorrespondingObjectFromSource(fbxGo));<span class="comment">//获取fbx在Project中的路径</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> importer = AssetImporter.GetAtPath(fbxPath) <span class="keyword">as</span> ModelImporter;</span><br><span class="line">            <span class="keyword">if</span> (importer == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            importer.optimizeGameObjects = <span class="literal">false</span>;</span><br><span class="line">            importer.SaveAndReimport();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>优化：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Optimize</span>(<span class="params">GameObject root</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> animator = root.GetComponentInChildren&lt;Animator&gt;();</span><br><span class="line">            <span class="keyword">if</span> (animator == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> fbxGo = animator.gameObject;</span><br><span class="line">            <span class="keyword">var</span> dummys = root.GetComponentsInChildren&lt;DummyData&gt;();<span class="comment">//自定义的虚拟挂载点</span></span><br><span class="line">            List&lt;<span class="built_in">string</span>&gt; exposedTransNameList = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> dummy <span class="keyword">in</span> dummys)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (dummy.Parent != <span class="literal">null</span> &amp;&amp; dummy.Parent != dummy.Root)<span class="comment">//筛选绑在骨骼上的挂载点</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> fullPath = AnimationUtility.CalculateTransformPath(dummy.Parent.transform, fbxGo.transform);<span class="comment">//获取骨骼的完整路径</span></span><br><span class="line">                    exposedTransNameList.Add(fullPath);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">var</span> fbxPath = AssetDatabase.GetAssetPath(PrefabUtility.GetCorrespondingObjectFromSource(fbxGo));</span><br><span class="line">            <span class="keyword">var</span> importer = AssetImporter.GetAtPath(fbxPath) <span class="keyword">as</span> ModelImporter;</span><br><span class="line">            <span class="keyword">if</span> (importer == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            importer.optimizeGameObjects = <span class="literal">true</span>;</span><br><span class="line">            importer.extraExposedTransformPaths = exposedTransNameList.ToArray();</span><br><span class="line">            importer.SaveAndReimport();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>优化后可以看到fbx meta文件变化：<br><img src="https://img-blog.csdnimg.cn/20200312143946235.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2020/03/12/Unity%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96!Optimize%20Game%20Objects/" data-id="cl5nt9713000mmpuvc9gqawkv" data-title="Unity动画优化:Optimize Game Objects" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-bilibili发送弹幕" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/02/24/bilibili%E5%8F%91%E9%80%81%E5%BC%B9%E5%B9%95/" class="article-date">
  <time class="dt-published" datetime="2020-02-23T17:51:40.000Z" itemprop="datePublished">2020-02-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Python/">Python</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/02/24/bilibili%E5%8F%91%E9%80%81%E5%BC%B9%E5%B9%95/">bilibili发送弹幕</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>媳妇儿玩起了bilibili直播，我就顺便研究下利用python发送弹幕，以表支持～，主要思路通过发送http请求。</p>
<h3 id="发送弹幕"><a href="#发送弹幕" class="headerlink" title="发送弹幕"></a>发送弹幕</h3><h4 id="1-查询http请求"><a href="#1-查询http请求" class="headerlink" title="1. 查询http请求"></a>1. 查询http请求</h4><p>首先登录b站，进入直播间，打开开发者工具，先在直播间发送一条弹幕。</p>
<p>可以看到请求的url地址，请求方式是post，以及请求的表单数据：<br><img src="https://img-blog.csdnimg.cn/20200224013846240.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-查询自己账号cookie和user-agent信息"><a href="#2-查询自己账号cookie和user-agent信息" class="headerlink" title="2. 查询自己账号cookie和user-agent信息"></a>2. 查询自己账号cookie和user-agent信息</h4><p>打开开发者工具，进入个人中心&#x2F;首页：<br><img src="https://img-blog.csdnimg.cn/20200224013940614.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-代码"><a href="#3-代码" class="headerlink" title="3. 代码"></a>3. 代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">bullet_screen</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, room_id</span>):</span><br><span class="line">        self.room_id = room_id</span><br><span class="line">        self.send_url = <span class="string">&quot;https://api.live.bilibili.com/msg/send&quot;</span></span><br><span class="line">        self.cookie = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;填入上图查询到的cookie&#x27;</span>&#125;</span><br><span class="line">        self.header = &#123;<span class="string">&#x27;User-Agent&#x27;</span> : <span class="string">&#x27;填入上图查询到的userAgent&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">        self.send_data = &#123;</span><br><span class="line">            <span class="string">&#x27;color&#x27;</span>: <span class="number">16777215</span>,</span><br><span class="line">            <span class="string">&#x27;fontsize&#x27;</span>: <span class="number">25</span>,</span><br><span class="line">            <span class="string">&#x27;mode&#x27;</span>: <span class="number">1</span>,</span><br><span class="line">            <span class="string">&#x27;msg&#x27;</span>: <span class="string">&#x27;123&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;rnd&#x27;</span>: <span class="number">1582471255</span>,</span><br><span class="line">            <span class="string">&#x27;roomid&#x27;</span>: room_id,</span><br><span class="line">            <span class="string">&#x27;bubble&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;csrf_token&#x27;</span>: <span class="string">&#x27;44d0e7f3eaea7ff05774822e8eaf49b2&#x27;</span>,</span><br><span class="line">            <span class="string">&#x27;csrf&#x27;</span>: <span class="string">&#x27;44d0e7f3eaea7ff05774822e8eaf49b2&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send</span>(<span class="params">self, msg</span>):</span><br><span class="line">        self.send_data[<span class="string">&#x27;rnd&#x27;</span>] = time.time() <span class="comment">#获得当前的时间戳</span></span><br><span class="line">        self.send_data[<span class="string">&#x27;msg&#x27;</span>] = msg</span><br><span class="line">        reponse = requests.post(self.send_url, data=self.send_data,cookies=self.cookie,headers=self.header)</span><br><span class="line">        <span class="keyword">return</span> reponse</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bullet_screen = bullet_screen(<span class="number">21912783</span>)</span><br><span class="line">    response = bullet_screen.send(<span class="string">&#x27;棒棒哒&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<h3 id="查询弹幕"><a href="#查询弹幕" class="headerlink" title="查询弹幕"></a>查询弹幕</h3><h4 id="1-查询http请求-1"><a href="#1-查询http请求-1" class="headerlink" title="1. 查询http请求"></a>1. 查询http请求</h4><p>打开开发者工具，刷新下页面，找到一个msg信息，可以得到路径和表单信息：<br><img src="https://img-blog.csdnimg.cn/20200224014122429.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="2-查询返回信息结构"><a href="#2-查询返回信息结构" class="headerlink" title="2. 查询返回信息结构"></a>2. 查询返回信息结构</h4><p>在Preview 标签中可以看到返回了最后10条弹幕：<br><img src="https://img-blog.csdnimg.cn/20200224014214328.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<h4 id="3-代码-1"><a href="#3-代码-1" class="headerlink" title="3. 代码"></a>3. 代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">bullet_screen</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, room_id</span>):</span><br><span class="line">        self.room_id = room_id</span><br><span class="line">        self.query_url = <span class="string">&#x27;https://api.live.bilibili.com/ajax/msg&#x27;</span></span><br><span class="line">        self.cookie = &#123;<span class="string">&#x27;Cookie&#x27;</span> : <span class="string">&#x27;填入上图查询到的cookie&#x27;</span>&#125;</span><br><span class="line">        self.header = &#123;<span class="string">&#x27;User-Agent&#x27;</span> : <span class="string">&#x27;填入上图查询到的userAgent&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">        self.query_data = &#123;</span><br><span class="line">            <span class="string">&#x27;roomid&#x27;</span>: room_id,</span><br><span class="line">            <span class="string">&#x27;csrf_token&#x27;</span>: <span class="string">&#x27;44d0e7f3eaea7ff05774822e8eaf49b2&#x27;</span>,</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">query</span>(<span class="params">self</span>):</span><br><span class="line">        response = requests.post(self.query_url, data = self.query_data)</span><br><span class="line">        rooms = response.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;room&#x27;</span>]</span><br><span class="line">        count = <span class="built_in">len</span>(rooms)</span><br><span class="line">        <span class="keyword">if</span> count &gt; <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> rooms[count - <span class="number">1</span>][<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bullet_screen = bullet_screen(<span class="number">21912783</span>)</span><br><span class="line">    response = bullet_screen.query()</span><br><span class="line">    <span class="comment"># bullet_screen.send(response)</span></span><br><span class="line">    <span class="built_in">print</span>(response)</span><br></pre></td></tr></table></figure>

<p>获得最近一条弹幕，这样就可以跟着发送相同弹幕了</p>
<h3 id="自动聊天弹幕"><a href="#自动聊天弹幕" class="headerlink" title="自动聊天弹幕"></a>自动聊天弹幕</h3><p>网上有个图灵机器人，可以实现人机对话，挺有趣，利用它来发送弹幕内容。</p>
<h4 id="1-注册"><a href="#1-注册" class="headerlink" title="1. 注册"></a>1. 注册</h4><p>首先到<a target="_blank" rel="noopener" href="http://www.tuling123.com/">图灵机器人</a>注册，创建机器人，得到一个32位的key。</p>
<h4 id="2，http请求"><a href="#2，http请求" class="headerlink" title="2，http请求"></a>2，http请求</h4><p>请求接口为<a target="_blank" rel="noopener" href="http://openapi.tuling123.com/openapi/api/v2%EF%BC%8C%E6%96%B9%E5%BC%8F%E4%B8%BApost%EF%BC%8C%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0%E4%B8%BA%E5%A6%82%E4%B8%8Bjson%E6%A0%BC%E5%BC%8F%EF%BC%9A">http://openapi.tuling123.com/openapi/api/v2，方式为post，请求参数为如下json格式：</a></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;reqType&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;perception&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;inputText&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;附近的酒店&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;inputImage&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;imageUrl&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;selfInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;location&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;city&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;province&quot;</span><span class="punctuation">:</span> <span class="string">&quot;北京&quot;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="attr">&quot;street&quot;</span><span class="punctuation">:</span> <span class="string">&quot;信息路&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;userInfo&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;apiKey&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;userId&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="3-返回格式"><a href="#3-返回格式" class="headerlink" title="3. 返回格式"></a>3. 返回格式</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;intent&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="number">10005</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;intentName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;actionName&quot;</span><span class="punctuation">:</span> <span class="string">&quot;&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;parameters&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;nearby_place&quot;</span><span class="punctuation">:</span> <span class="string">&quot;酒店&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;results&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">         	<span class="attr">&quot;groupType&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;resultType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;url&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://m.elong.com/hotel/0101/nlist/#indate=2016-12-10&amp;outdate=2016-12-11&amp;keywords=%E4%BF%A1%E6%81%AF%E8%B7%AF&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">         	<span class="attr">&quot;groupType&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;resultType&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;values&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="string">&quot;亲，已帮你找到相关酒店信息&quot;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h4 id="4-代码"><a href="#4-代码" class="headerlink" title="4. 代码"></a>4. 代码</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">bullet_screen</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, room_id</span>):</span><br><span class="line">        self.room_id = room_id</span><br><span class="line">        self.api_key = <span class="string">&#x27;&#x27;</span><span class="comment"># 填注册后获得的32位key</span></span><br><span class="line">        self.user_id = <span class="string">&#x27;9527&#x27;</span><span class="comment">#随便填</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_robot_dialogue</span>(<span class="params">self, msg</span>):</span><br><span class="line">        api_url = <span class="string">&#x27;http://openapi.tuling123.com/openapi/api/v2&#x27;</span></span><br><span class="line">        req = &#123;</span><br><span class="line">            <span class="string">&#x27;reqType&#x27;</span>: <span class="number">0</span>,</span><br><span class="line">            <span class="string">&#x27;perception&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;inputText&#x27;</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;text&#x27;</span>: msg</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&#x27;userInfo&#x27;</span>: &#123;</span><br><span class="line">                <span class="string">&#x27;apiKey&#x27;</span>: self.api_key,</span><br><span class="line">                <span class="string">&#x27;userId&#x27;</span>: self.user_id</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        req = json.dumps(req).encode(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">        response = requests.post(api_url, data=req, headers=&#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>&#125;)</span><br><span class="line">        response_dic = response.json()</span><br><span class="line">        intent_code = response_dic[<span class="string">&#x27;intent&#x27;</span>][<span class="string">&#x27;code&#x27;</span>]</span><br><span class="line">        results_text = response_dic[<span class="string">&#x27;results&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;values&#x27;</span>][<span class="string">&#x27;text&#x27;</span>]</span><br><span class="line">        <span class="keyword">return</span> intent_code, results_text</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bullet_screen = bullet_screen(<span class="number">21912783</span>)</span><br><span class="line">    code,text = bullet_screen.get_robot_dialogue(<span class="string">&#x27;主播棒棒哒&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(code,text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p>现在可以根据最新一条弹幕内容，发送自动对话的结果了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    bullet_screen = bullet_screen(<span class="number">21912783</span>)</span><br><span class="line">    lastMsg = bullet_screen.query()</span><br><span class="line">    code, dialogue = bullet_screen.get_robot_dialogue(lastMsg)</span><br><span class="line">    <span class="keyword">if</span> code == <span class="number">0</span>:</span><br><span class="line">        response = bullet_screen.send(dialogue)</span><br><span class="line">    <span class="built_in">print</span>(lastMsg,dialogue)</span><br></pre></td></tr></table></figure>

<p>效果如下：<br><img src="https://img-blog.csdnimg.cn/20200224015047284.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<p>图灵机器人没有验证或者购买的话，只有3次免费试用机会，笑哭</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2020/02/24/bilibili%E5%8F%91%E9%80%81%E5%BC%B9%E5%B9%95/" data-id="cl5nt9715000smpuv63sz920n" data-title="bilibili发送弹幕" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-批量删除预制脚本" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/01/03/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E9%A2%84%E5%88%B6%E8%84%9A%E6%9C%AC/" class="article-date">
  <time class="dt-published" datetime="2020-01-02T16:54:06.000Z" itemprop="datePublished">2020-01-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Unity/">Unity</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/01/03/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E9%A2%84%E5%88%B6%E8%84%9A%E6%9C%AC/">批量删除预制脚本</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h3 id="环境：Unity-2018-4-12"><a href="#环境：Unity-2018-4-12" class="headerlink" title="环境：Unity 2018.4.12"></a>环境：Unity 2018.4.12</h3><h3 id="需求："><a href="#需求：" class="headerlink" title="需求："></a>需求：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">项目中经常需要在Unity Editor模式下批量删除Prefab中的某个脚本，但是直接用`GameObject.DestroyImmediate(obj);`会报错：Destroying assets is not permitted to avoid data loss.解决方法是通过`SerializedProperty.DeleteArrayElementAtIndex(i)`。</span><br></pre></td></tr></table></figure>

<h3 id="代码："><a href="#代码：" class="headerlink" title="代码："></a>代码：</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">RemoveComponents</span>(<span class="params">Component[] components</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (components.Length == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> component <span class="keyword">in</span> components)</span><br><span class="line">            &#123;</span><br><span class="line">                SerializedObject so = <span class="keyword">new</span> SerializedObject(component.gameObject);</span><br><span class="line">                SerializedProperty sp = so.FindProperty(<span class="string">&quot;m_Component&quot;</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">var</span> allComponents = component.gameObject.GetComponents&lt;Component&gt;();</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>, len = allComponents.Length; i &lt; len; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (allComponents[i] == component)</span><br><span class="line">                    &#123;</span><br><span class="line">                        sp.DeleteArrayElementAtIndex(i);</span><br><span class="line">                        so.ApplyModifiedProperties();</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span>  <span class="built_in">bool</span> <span class="title">RemoveComponents</span>&lt;<span class="title">T</span>&gt;(<span class="params">GameObject root</span>) <span class="keyword">where</span> T : Component</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (root == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">var</span> components = root.GetComponentsInChildren&lt;T&gt;(<span class="literal">true</span>);</span><br><span class="line">            <span class="keyword">return</span> RemoveComponents(components);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<h3 id="工具"><a href="#工具" class="headerlink" title="工具"></a>工具</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为了方便使用，实现一个EditorWindow来操作，代码如下：</span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> UnityEditor;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Common.Editor.Common</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RemoveComponentEditor</span> : <span class="title">EditorWindow</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> RemoveComponentEditor _instance;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span>[] _selectAssets;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> _key;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> MonoScript _monoScript;</span><br><span class="line">        </span><br><span class="line">        [<span class="meta">MenuItem(<span class="string">&quot;PrefabTool/RemoveComponentEditor&quot;</span>)</span>]</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ShowWindow</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _instance = GetWindow(<span class="keyword">typeof</span>(RemoveComponentEditor)) <span class="keyword">as</span> RemoveComponentEditor;</span><br><span class="line">            _instance.Show();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            _selectAssets = Selection.assetGUIDs;</span><br><span class="line">            <span class="keyword">if</span> (_selectAssets == <span class="literal">null</span> || _selectAssets.Length == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">&quot;No Assets Selected&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                EditorGUILayout.LabelField(<span class="string">$&quot;Selected Assets：\n&quot;</span>);</span><br><span class="line">                <span class="keyword">foreach</span> (<span class="keyword">var</span> asset <span class="keyword">in</span> _selectAssets)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> path = AssetDatabase.GUIDToAssetPath(asset);</span><br><span class="line">                    EditorGUILayout.LabelField(<span class="string">$&quot;<span class="subst">&#123;path&#125;</span>\n&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            _key = EditorGUILayout.TextField(<span class="string">&quot;Prefab Name Key:&quot;</span>, _key);</span><br><span class="line">            _monoScript = EditorGUILayout.ObjectField(<span class="string">&quot;Script&quot;</span>, _monoScript, <span class="keyword">typeof</span>(MonoScript), <span class="literal">false</span>) <span class="keyword">as</span> MonoScript;</span><br><span class="line">            <span class="keyword">if</span> (GUILayout.Button(<span class="string">&quot;Remove&quot;</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                Remove();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Remove</span>()</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (_selectAssets == <span class="literal">null</span> || _selectAssets.Length == <span class="number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.DisplayDialog(<span class="string">&quot;Error&quot;</span>, <span class="string">&quot;Please Select A Folder Or Asset&quot;</span>, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (_monoScript == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.DisplayDialog(<span class="string">&quot;Error&quot;</span>, <span class="string">&quot;Please Select A Mono Script&quot;</span>, <span class="string">&quot;OK&quot;</span>);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> prefabs = CommonToolUtil.GetSelectPrefabs(_key);</span><br><span class="line">            CommonToolUtil.ExecutePrefabs(prefabs, Execute, <span class="string">&quot;Execute&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="function"><span class="keyword">private</span> <span class="built_in">bool</span> <span class="title">Execute</span>(<span class="params">GameObject prefab</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> CommonToolUtil.RemoveComponents(prefab, _monoScript);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>GetSelectPrefabs()函数用来获得选中目录下的所有Prefabs,参数key用来过滤Prefab的名字，因为一个文件夹下可能有多个采用不同前后缀命名的Variant：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;GameObject&gt; <span class="title">GetSelectPrefabs</span>(<span class="params"><span class="built_in">string</span> key</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;GameObject&gt; list = <span class="keyword">new</span> List&lt;GameObject&gt;();</span><br><span class="line">            Object[] selectedAssets = Selection.GetFiltered(<span class="keyword">typeof</span>(Object), SelectionMode.DeepAssets);</span><br><span class="line">            <span class="keyword">foreach</span> (Object asset <span class="keyword">in</span> selectedAssets)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="built_in">string</span> filePath = AssetDatabase.GetAssetPath(asset);</span><br><span class="line">                <span class="keyword">if</span> (!filePath.EndsWith(<span class="string">&quot;.prefab&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (!<span class="built_in">string</span>.IsNullOrEmpty(key))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">var</span> fileName = Path.GetFileNameWithoutExtension(filePath);</span><br><span class="line">                    <span class="keyword">if</span> (!fileName.Contains(key))</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">var</span> prefab = AssetDatabase.LoadAssetAtPath&lt;GameObject&gt;(filePath);</span><br><span class="line">                <span class="keyword">if</span> (prefab == <span class="literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                list.Add(prefab);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> list;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ExecutePrefabs函数遍历Prefabs，并显示进度条，有修改则保存</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ExecutePrefabs</span>(<span class="params">List&lt;GameObject&gt; prefabs, Func&lt;GameObject, <span class="built_in">bool</span>&gt; action, <span class="built_in">string</span> content, <span class="built_in">bool</span> save = <span class="literal">true</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> count = prefabs.Count;</span><br><span class="line">            <span class="keyword">var</span> index = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">foreach</span> (<span class="keyword">var</span> prefab <span class="keyword">in</span> prefabs)</span><br><span class="line">            &#123;</span><br><span class="line">                EditorUtility.DisplayProgressBar(content,</span><br><span class="line">                    <span class="string">$&quot;<span class="subst">&#123;content&#125;</span>...<span class="subst">&#123;++index&#125;</span>/<span class="subst">&#123;count&#125;</span>&quot;</span>, (<span class="built_in">float</span>) index / count);</span><br><span class="line">                <span class="built_in">bool</span> result = action.Invoke(prefab);</span><br><span class="line">                <span class="keyword">if</span> (save &amp;&amp; result)</span><br><span class="line">                &#123;</span><br><span class="line">                    PrefabUtility.SavePrefabAsset(prefab);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (save)</span><br><span class="line">            &#123;</span><br><span class="line">                AssetDatabase.SaveAssets();</span><br><span class="line">                AssetDatabase.Refresh();</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            EditorUtility.ClearProgressBar();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>RemoveComponents函数通过MonoScript获得Component数组，调用上面的方法移除组件</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">bool</span> <span class="title">RemoveComponents</span>(<span class="params">GameObject root, MonoScript monoScript</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (root == <span class="literal">null</span> || monoScript == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> type = monoScript.GetClass();</span><br><span class="line">            <span class="keyword">if</span> (type == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> components = root.GetComponentsInChildren(type);</span><br><span class="line">            <span class="keyword">return</span> RemoveComponents(components);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>运行效果如图：<br>可以选择目录或预制，设置关键词过滤，选择要删除的组件<br><img src="https://img-blog.csdnimg.cn/20200103004743870.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="Editor"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2020/01/03/%E6%89%B9%E9%87%8F%E5%88%A0%E9%99%A4%E9%A2%84%E5%88%B6%E8%84%9A%E6%9C%AC/" data-id="cl5nt9717000xmpuv2uiqdnxz" data-title="批量删除预制脚本" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-Timeline Note--引用无关资源" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/21/Timeline%20Note--%E5%BC%95%E7%94%A8%E6%97%A0%E5%85%B3%E8%B5%84%E6%BA%90/" class="article-date">
  <time class="dt-published" datetime="2019-08-21T04:09:46.000Z" itemprop="datePublished">2019-08-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Timeline/">Timeline</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/21/Timeline%20Note--%E5%BC%95%E7%94%A8%E6%97%A0%E5%85%B3%E8%B5%84%E6%BA%90/">Timeline Note--引用无关资源</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<h2 id="一，环境："><a href="#一，环境：" class="headerlink" title="一，环境："></a>一，环境：</h2><p>Unity 2018.4.2</p>
<h2 id="二，结构"><a href="#二，结构" class="headerlink" title="二，结构"></a>二，结构</h2><p><img src="https://img-blog.csdnimg.cn/20190821091449385.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图1"><br>一个Prefab一段Timeline演出，Prefab上会挂PlayableDirector组件，并绑定Timeline Asset。<br><img src="https://img-blog.csdnimg.cn/20190821092510174.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图2"><br>Timeline Asset的编辑内容</p>
<h2 id="三，现象"><a href="#三，现象" class="headerlink" title="三，现象"></a>三，现象</h2><p><img src="https://img-blog.csdnimg.cn/20190821091730566.png" alt="图3"><br>对预制执行Select Dependencies发现：<br><img src="https://img-blog.csdnimg.cn/20190821091804823.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图4"><br>该预制额外地引用了一些无关的资源，例如两个FBX资源，动作（skill2_x），甚至还引用了其它的Timeline Asset（4110092，BossShow）。</p>
<h2 id="四，分析"><a href="#四，分析" class="headerlink" title="四，分析"></a>四，分析</h2><p>1，通过查看prefab和meta文件：<br><img src="https://img-blog.csdnimg.cn/20190821094322208.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图5"><br>发现PlayableDirector的m_SceneBindings有很多guid的引用。但由图1、图2可见Timeline Asset中其实只有8个绑定。<br>2，选择Inspector的Debug模式<img src="https://img-blog.csdnimg.cn/20190821095033461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图6"><br><img src="https://img-blog.csdnimg.cn/20190821095044203.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图7"><br>发现竟然有28个绑定。<br>3，经测试发现，复制Prefab时，PlayableDirector组件的Binding也会跟着复制，即使关联新的TimelineAsset，也不会清空重新赋值，估计Unity后面版本会修复。</p>
<h2 id="五，解决"><a href="#五，解决" class="headerlink" title="五，解决"></a>五，解决</h2><p>PlayableDirector组件的Binding字段是写在c++，也没有提供访问或清空的接口。因此采用重挂组件再赋值的办法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">public static void OptimizeBinding(GameObject go)</span><br><span class="line">&#123;</span><br><span class="line">    var prefab = GameObject.Instantiate(go);</span><br><span class="line">    var director = prefab.GetComponent&lt;PlayableDirector&gt;();</span><br><span class="line">    if (director == null)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    var timelineAsset = director.playableAsset as TimelineAsset;</span><br><span class="line">    if (timelineAsset == null)</span><br><span class="line">    &#123;</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    Dictionary&lt;UnityEngine.Object, UnityEngine.Object&gt; bindings = new Dictionary&lt;UnityEngine.Object, UnityEngine.Object&gt;();</span><br><span class="line">    foreach (var pb in director.playableAsset.outputs)</span><br><span class="line">    &#123;</span><br><span class="line">        var key = pb.sourceObject;</span><br><span class="line">        var value = director.GetGenericBinding(key);</span><br><span class="line">        if (!bindings.ContainsKey(key))</span><br><span class="line">        &#123;</span><br><span class="line">            bindings.Add(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    GameObject.DestroyImmediate(director);</span><br><span class="line">    director = prefab.AddComponent&lt;PlayableDirector&gt;();</span><br><span class="line">    director.playableAsset = timelineAsset;</span><br><span class="line">    director.playOnAwake = false;</span><br><span class="line">    foreach (var pair in bindings)</span><br><span class="line">    &#123;</span><br><span class="line">        director.SetGenericBinding(pair.Key, pair.Value);</span><br><span class="line">    &#125;</span><br><span class="line">    var path = AssetDatabase.GetAssetPath(go);</span><br><span class="line">    PrefabUtility.SaveAsPrefabAsset(prefab, path, out var success);</span><br><span class="line">    GameObject.DestroyImmediate(prefab);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="六，结果"><a href="#六，结果" class="headerlink" title="六，结果"></a>六，结果</h2><p><img src="https://img-blog.csdnimg.cn/20190821112430959.png" alt="图8"><br><img src="https://img-blog.csdnimg.cn/20190821112444534.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70" alt="图9"><br>运行脚本后，Prefab不再引用不相关的资源，PlayableDirector的Binding数量也跟TimelineAsset的Track数量一致。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2019/08/21/Timeline%20Note--%E5%BC%95%E7%94%A8%E6%97%A0%E5%85%B3%E8%B5%84%E6%BA%90/" data-id="cl5nt970y000ampuv76zd1yp5" data-title="Timeline Note--引用无关资源" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Timeline-%E5%9D%91-%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8-%E8%B5%84%E6%BA%90%E4%BE%9D%E8%B5%96/" rel="tag">Timeline 坑 资源引用 资源依赖</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-Timeline 一，简介" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/08/12/Timeline%20%E4%B8%80%EF%BC%8C%E7%AE%80%E4%BB%8B/" class="article-date">
  <time class="dt-published" datetime="2019-08-12T12:00:51.000Z" itemprop="datePublished">2019-08-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Timeline/">Timeline</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/08/12/Timeline%20%E4%B8%80%EF%BC%8C%E7%AE%80%E4%BB%8B/">Timeline 一，简介</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<p>尊重原创，转载请在文首注明出处：<a target="_blank" rel="noopener" href="https://blog.csdn.net/cai612781/article/details/99330696">https://blog.csdn.net/cai612781/article/details/99330696</a></p>
<p>环境：</p>
<p>Unity 2018.4</p>
<p> </p>
<p>一，Introduction</p>
<p>1.1,Timeline</p>
<p>Timeline是Unity2017新增的一个用于方便组织场景动画的工具，可用来制作剧情动画、技能演出等，还可配合Cinemachine做运镜。</p>
<p>1.2,,Timeline Asset</p>
<p>Timeline在Unity中是一种Asset资源文件，通过Asset&#x2F;Create&#x2F;Timeline菜单创建。</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195749117.png"></p>
<p> </p>
<p> </p>
<p> </p>
<p>1.3,Playable Director Component</p>
<p>PlayableDirector是用来播放Timeline Asset的组件。</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195810914.png"></p>
<p> </p>
<p>1.4 Playable Graph</p>
<p>编辑好的一个Timeline Asset，在播放时，会创建成一个Playable Graph，Playable Graph相当于Timeline Asset的一个实例，因此一个Timeline Asset可以被多个Playable Directory同时播放，互不干扰。</p>
<p> </p>
<p>二，Using Timeline</p>
<p>2.1,Timeline Editor</p>
<p>双击Timeline Asset，或Window&#x2F;Timeline Editor菜单可打开Timeline编辑器。</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195822842.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70"></p>
<p> </p>
<p>Official Track &amp; Group:</p>
<p>2.1.1 TrackGroup</p>
<p>分组的概念</p>
<p>2.1.2 Activation Track</p>
<p>显示&#x2F;隐藏</p>
<p>2.1.3 Animation Track</p>
<p>播放动作</p>
<p>2.1.4 Audio Track</p>
<p>播放音效</p>
<p>2.1.5 Control Track</p>
<p>控制GameObject，粒子特效，嵌套Playable Directory</p>
<p>2.1.6 Playable Track</p>
<p>脚本</p>
<p>2.1.7 Signal Track</p>
<p>Unity 2019才有的功能，用于发送信号，类似关键帧</p>
<p>2.1.8 Cinemachine Track</p>
<p>安装Cinemachine Package后，可控制虚拟相机做运镜</p>
<p> </p>
<p>2.2 Clips</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195836736.png"></p>
<p> </p>
<p>每条轨道(track)上，可以创建多个对应的clip，clip上关联资源或者数据.</p>
<p>当两个clip重叠时，重叠区域会进行融合。</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195905907.png"></p>
<p> </p>
<p>每个clip上都会有开始、结束、持续的时间配置，对应在轨道上的位置和长度。</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195915334.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NhaTYxMjc4MQ==,size_16,color_FFFFFF,t_70"></p>
<p> </p>
<p>可融合的clip，例如Animation Clip还显示融合的参数配置</p>
<p><img src="https://img-blog.csdnimg.cn/2019081219592510.png"></p>
<p> </p>
<p>Pre-Extrapolate和Post-Extrapolate：分别代表clip前后的空白间隙如何表现：</p>
<p>Hold：保持在最接近clip的一帧状态；</p>
<p>Loop：循环播放clip；</p>
<p>PingPong:前向和后向循环播放；</p>
<p>Continue:根据动画原始资源设置的循环模式播放；</p>
<p> </p>
<p> </p>
<p> </p>
<p>2.3,Recording and Editing Animation</p>
<p><img src="https://img-blog.csdnimg.cn/20190812195938573.png"></p>
<p> </p>
<p>Animation Track有个红点，支持录制一段Animation动画。</p>
<p>录制的动画可以有infinite track和clip tracks两种形态。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2019/08/12/Timeline%20%E4%B8%80%EF%BC%8C%E7%AE%80%E4%BB%8B/" data-id="cl5nt970z000bmpuvf03n3han" data-title="Timeline 一，简介" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Timeline/" rel="tag">Timeline</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ps脚本解析psd文本字号" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/08/25/ps%E8%84%9A%E6%9C%AC%E8%A7%A3%E6%9E%90psd%E6%96%87%E6%9C%AC%E5%AD%97%E5%8F%B7/" class="article-date">
  <time class="dt-published" datetime="2018-08-25T06:59:52.000Z" itemprop="datePublished">2018-08-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PhotoShop/">PhotoShop</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/08/25/ps%E8%84%9A%E6%9C%AC%E8%A7%A3%E6%9E%90psd%E6%96%87%E6%9C%AC%E5%AD%97%E5%8F%B7/">ps脚本解析psd文本字号</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<p>ps脚本解析psd中文本字号最简单的方法，通过DOM获取：var size &#x3D; activeDocument.activeLayer.textItem.size;  </p>
<p>但是当该文本被拉伸过后，DOM解析出来的字号就会错误。正确的方式是通过Action Manager来获取：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getTextSize</span>(<span class="params"></span>)&#123;  </span><br><span class="line">    <span class="keyword">var</span> ref = <span class="keyword">new</span> <span class="title class_">ActionReference</span>();  </span><br><span class="line">    ref.<span class="title function_">putEnumerated</span>( <span class="title function_">charIDToTypeID</span>(<span class="string">&quot;Lyr &quot;</span>), <span class="title function_">charIDToTypeID</span>(<span class="string">&quot;Ordn&quot;</span>), <span class="title function_">charIDToTypeID</span>(<span class="string">&quot;Trgt&quot;</span>) );   </span><br><span class="line">    <span class="keyword">var</span> desc = <span class="title function_">executeActionGet</span>(ref).<span class="title function_">getObjectValue</span>(<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;textKey&#x27;</span>));  </span><br><span class="line">    <span class="keyword">var</span> textSize =  desc.<span class="title function_">getList</span>(<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;textStyleRange&#x27;</span>)).<span class="title function_">getObjectValue</span>(<span class="number">0</span>).<span class="title function_">getObjectValue</span>(<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;textStyle&#x27;</span>)).<span class="property">getDouble</span> (<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;size&#x27;</span>));  </span><br><span class="line">    <span class="keyword">if</span> (desc.<span class="title function_">hasKey</span>(<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;transform&#x27;</span>))) </span><br><span class="line">    &#123;  </span><br><span class="line">            <span class="keyword">var</span> mFactor = desc.<span class="title function_">getObjectValue</span>(<span class="title function_">stringIDToTypeID</span>(<span class="string">&#x27;transform&#x27;</span>)).<span class="property">getUnitDoubleValue</span> (<span class="title function_">stringIDToTypeID</span>(<span class="string">&quot;yy&quot;</span>) );  </span><br><span class="line">            textSize = (textSize* mFactor).<span class="title function_">toFixed</span>(<span class="number">0</span>);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> textSize;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2018/08/25/ps%E8%84%9A%E6%9C%AC%E8%A7%A3%E6%9E%90psd%E6%96%87%E6%9C%AC%E5%AD%97%E5%8F%B7/" data-id="cl5nt97180010mpuvgw021snd" data-title="ps脚本解析psd文本字号" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C#调用可执行文件" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/11/C#%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" class="article-date">
  <time class="dt-published" datetime="2018-01-11T01:50:59.000Z" itemprop="datePublished">2018-01-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/C/">C#</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/11/C#%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/">C#调用可执行文件</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <span id="more"></span>

<p>尊重原创，转载请在文首注明出处：<a target="_blank" rel="noopener" href="http://blog.csdn.net/cai612781/article/details/79030654">http://blog.csdn.net/cai612781/article/details/79030654</a></p>
<p>一，语法</p>
<p>C#提供Process类来对本地或远程进程进行访问，以及启动或停止本地进程。</p>
<p>更多语法信息：<a target="_blank" rel="noopener" href="https://msdn.microsoft.com/zh-cn/library/system.diagnostics.process.aspx">https://msdn.microsoft.com/zh-cn/library/system.diagnostics.process.aspx</a></p>
<p>二，代码</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Diagnostics;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"><span class="keyword">using</span> Debug = UnityEngine.Debug;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Assets.Editor</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">EditorUtil</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">ExecuteProcess</span>(<span class="params"><span class="built_in">string</span> filePath, <span class="built_in">string</span> command, <span class="built_in">string</span> workPath = <span class="string">&quot;&quot;</span>, <span class="built_in">int</span> seconds = <span class="number">0</span></span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(filePath))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Process process = <span class="keyword">new</span> Process();<span class="comment">//创建进程对象</span></span><br><span class="line">            process.StartInfo.WorkingDirectory = workPath;</span><br><span class="line">            process.StartInfo.FileName = filePath;</span><br><span class="line">            process.StartInfo.Arguments = command;</span><br><span class="line">            process.StartInfo.CreateNoWindow = <span class="literal">true</span>;</span><br><span class="line">            process.StartInfo.RedirectStandardOutput = <span class="literal">false</span>;<span class="comment">//不重定向输出</span></span><br><span class="line">            <span class="keyword">try</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (process.Start())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">if</span> (seconds == <span class="number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        process.WaitForExit(); <span class="comment">//无限等待进程结束</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        process.WaitForExit(seconds); <span class="comment">//等待毫秒</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Debug.LogError(e.Message);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span></span><br><span class="line">            &#123;</span><br><span class="line">                process.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://godwintsai.github.io/2018/01/11/C#%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" data-id="cl5nt970u0004mpuv180kg77a" data-title="C#调用可执行文件" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C-%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B-C-%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" rel="tag">C#启动进程 C#调用可执行文件</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C#</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ngui/">Ngui</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PhotoShop/">PhotoShop</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Timeline/">Timeline</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity/">Unity</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Unity-Optimize/">Unity Optimize</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B-C-%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" rel="tag">C#启动进程 C#调用可执行文件</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6-%E5%88%A0%E9%99%A4%E5%8F%AA%E8%AF%BB%E6%96%87%E4%BB%B6%E5%BC%82%E5%B8%B8/" rel="tag">C#复制文件 删除只读文件异常</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C-%E8%B0%83%E7%94%A8SVN/" rel="tag">C#调用SVN</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ETC1-Alpha/" rel="tag">ETC1 Alpha</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timeline/" rel="tag">Timeline</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Timeline-%E5%9D%91-%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8-%E8%B5%84%E6%BA%90%E4%BE%9D%E8%B5%96/" rel="tag">Timeline 坑 资源引用 资源依赖</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity/" rel="tag">Unity</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unity%E6%B8%B2%E6%9F%93%E5%B1%82%E7%BA%A7-ngui%E6%B8%B2%E6%9F%93%E5%B1%82%E7%BA%A7/" rel="tag">Unity渲染层级 ngui渲染层级</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/photoshop-script-ps-script-actionmanager/" rel="tag">photoshop script ps script actionmanager</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/unity-coroutine-unity%E5%8D%8F%E7%A8%8B-use-coroutine-in-uni-%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8D%8F%E7%A8%8B/" rel="tag">unity coroutine unity协程 use coroutine in uni 编辑器中使用协程</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C-%E5%90%AF%E5%8A%A8%E8%BF%9B%E7%A8%8B-C-%E8%B0%83%E7%94%A8%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6/" style="font-size: 10px;">C#启动进程 C#调用可执行文件</a> <a href="/tags/C-%E5%A4%8D%E5%88%B6%E6%96%87%E4%BB%B6-%E5%88%A0%E9%99%A4%E5%8F%AA%E8%AF%BB%E6%96%87%E4%BB%B6%E5%BC%82%E5%B8%B8/" style="font-size: 10px;">C#复制文件 删除只读文件异常</a> <a href="/tags/C-%E8%B0%83%E7%94%A8SVN/" style="font-size: 10px;">C#调用SVN</a> <a href="/tags/ETC1-Alpha/" style="font-size: 10px;">ETC1 Alpha</a> <a href="/tags/Timeline/" style="font-size: 10px;">Timeline</a> <a href="/tags/Timeline-%E5%9D%91-%E8%B5%84%E6%BA%90%E5%BC%95%E7%94%A8-%E8%B5%84%E6%BA%90%E4%BE%9D%E8%B5%96/" style="font-size: 10px;">Timeline 坑 资源引用 资源依赖</a> <a href="/tags/Unity/" style="font-size: 10px;">Unity</a> <a href="/tags/Unity%E6%B8%B2%E6%9F%93%E5%B1%82%E7%BA%A7-ngui%E6%B8%B2%E6%9F%93%E5%B1%82%E7%BA%A7/" style="font-size: 10px;">Unity渲染层级 ngui渲染层级</a> <a href="/tags/photoshop-script-ps-script-actionmanager/" style="font-size: 10px;">photoshop script ps script actionmanager</a> <a href="/tags/unity-coroutine-unity%E5%8D%8F%E7%A8%8B-use-coroutine-in-uni-%E7%BC%96%E8%BE%91%E5%99%A8%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%8D%8F%E7%A8%8B/" style="font-size: 10px;">unity coroutine unity协程 use coroutine in uni 编辑器中使用协程</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/07/16/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2020/04/02/Skill&Buff%20Editor/">Skill&amp;Buff Editor</a>
          </li>
        
          <li>
            <a href="/2020/04/01/Unity%E4%B8%96%E7%95%8C%E5%9D%90%E6%A0%87%E5%B1%80%E9%83%A8%E5%9D%90%E6%A0%87%E8%BD%AC%E6%8D%A2/">Unity世界坐标局部坐标转换</a>
          </li>
        
          <li>
            <a href="/2020/03/12/Unity%E5%8A%A8%E7%94%BB%E4%BC%98%E5%8C%96!Optimize%20Game%20Objects/">Unity动画优化:Optimize Game Objects</a>
          </li>
        
          <li>
            <a href="/2020/02/24/bilibili%E5%8F%91%E9%80%81%E5%BC%B9%E5%B9%95/">bilibili发送弹幕</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 GodwinTsai<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>